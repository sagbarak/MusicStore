@{
    ViewBag.Title = "Home Page";
}
<style>
    #header {
        background-image: url("/resources/jimi.jpg");
        background-repeat: no-repeat;
        background-size: cover;
        position: relative;
        text-decoration-color: white;
        opacity: 0.7;
    }
</style>
<div class="jumbotron" id="header">
    <h1 style="color:navajowhite;">Music Store</h1>
    <p class="lead" style="color:white;">your number one source for music!</p>
    <p><a href="https://www.facebook.com/Music-Store-2251737218187163/" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
    $.ajax({
        url: 'https://api.rss2json.com/v1/api.json',
        method: 'GET',
        dataType: 'json',
        data: {
            rss_url: 'https://pitchfork.com/rss/reviews/albums/',
            api_key: '1nvco4gqejqzmpmwij68qis3wxmymgkemfmvmwpc', // put your api key here
            count: 4
        }
    }).done(function (response) {
        if (response.status != 'ok') { throw response.message; }

        console.log('====== ' + response.feed.title + ' ======');

        var i = 4;
        $("#rss1").append(`<tr><td><h2 style="font-family:'AR CARTER';">${response.items[0].title}</h2></td></tr>
                                                           <tr><td style="font-family:'Comic Sans MS';"> ${response.items[0].description}</td><td><img src ="${response.items[0].thumbnail}" style="width:100px;height:100px; margin: 5px;"></td></tr>
                                                            <tr><td><a class="btn btn-default"
                                                                    href="${response.items[0].link}">Read more &raquo;</a></td></tr>`);
        $("#rss1").append(`<tr><td><h2 style="font-family:'AR CARTER';">${response.items[1].title}</h2></td></tr>
                                                           <tr><td style="font-family:'Comic Sans MS';"> ${response.items[1].description}</td><td><img src ="${response.items[1].thumbnail}" style="width:100px;height:100px; margin: 5px;"></td></tr>
                                                            <tr><td><a class="btn btn-default"
                                                                    href="${response.items[1].link}">Read more &raquo;</a></td></tr>`);
        $("#rss1").append(`<tr><td><h2 style="font-family:'AR CARTER';">${response.items[2].title}</h2></td></tr>
                                                           <tr><td style="font-family:'Comic Sans MS';"> ${response.items[2].description}</td><td><img src ="${response.items[2].thumbnail}" style="width:100px;height:100px; margin: 5px;"></td></tr>
                                                            <tr><td><a class="btn btn-default"
                                                                    href="${response.items[2].link}">Read more &raquo;</a></td></tr>`);
        $("#rss1").append(`<tr><td><h2 style="font-family:'AR CARTER';">${response.items[3].title}</h2></td></tr>
                                                           <tr><td style="font-family:'Comic Sans MS';"> ${response.items[3].description}</td><td><img src ="${response.items[3].thumbnail}" style="width:100px;height:100px; margin: 5px;"></td></tr>
                                                            <tr><td><a class="btn btn-default"
                                                                    href="${response.items[3].link}">Read more &raquo;</a></td></tr>`);
    });

</script>



<table style="width:100%;">
    <tr>
        <td style="width:50%;">
            <div style="width:90%; background-color:rgba(247, 246, 239,0.7); border-radius: 10px; padding:2px; margin-bottom:10px;">
                <h1 align="center" style="font-family:'AR CARTER'; ">Albums Review</h1>
            </div>
        </td>
        <td align="right" style="width:50%;">
            <div style="width:90%; background-color:rgba(247, 246, 239,0.7); border-radius: 10px; padding:2px; margin-bottom:10px;">
                <h1 align="center" style="font-family:'AR CARTER'; ">Our Feed</h1>
            </div>
        </td>
    </tr>
</table>
<table style="width:100%;">
    <tbody>
        <tr>
            <td>
                <div valign="top" style="width:90%;height:100%; background-color:rgba(247, 246, 239,0.8); border-radius: 10px; padding:10px;">
                    
                        <section id="rss1" style="margin-top:5px;"></section>
                    
                </div>
            </td>
            <td align="right" style="width:50%;">
                <div align="right" style="width:90%; height:100%; background-color:rgba(247, 246, 239,0.8); border-radius: 10px; padding:10px; margin-bottom:10px;">
                    <section align="center">
                        <h2 style="font-family:'AR CARTER'; font-size:30px;width:100%; position:center;">Best Seller Album</h2>
                        <center>
                            <section id="bestAlbum">
                                <img src="~/resources/Vinyl_Violet.png" style="width:200px; height:200px;" />
                            </section>
                        </center>
                    </section>
                </div>
                
                <div align="right" style="width:90%; height:100%; background-color:rgba(247, 246, 239,0.8); border-radius: 10px; padding:10px; margin-bottom:10px;">
                    <section align="center">
                        <h2 style="font-family:'AR CARTER'; width:100%; position:center;">Find The Best Album For you!:</h2>
                        <section id="searchByCity">
                            City:<input type="text" id="CitySr" value="" />
                            Age:<input type="number" id="Age" value="" />
                            <input id="SearchBtn" type="submit" value="Search" />
                        </section>
                        <section style="height:20%;">
                            <b>Results:</b>
                            <center><section id="SearchRes"></section></center>
                        </section>
                    </section>
                </div>
            
                <div align="right" style="width:90%; height:100%; background-color:rgba(247, 246, 239,0.8); border-radius: 10px; padding:10px; margin-bottom:10px;">
                    <section align="center">
                        <h2 style="font-family:'AR CARTER'; width:100%; position:center;">You Can Find The Best Prices in:</h2>
                        <center><section id="Cheapest"></section></center>
                    </section>
                </div>
                
                <div align="right" style="width:90%; height:100%; background-color:rgba(247, 246, 239,0.8); border-radius: 10px; padding:10px;">
                    <section>
                        <div id="fb-root"></div>
                        <script>
                            (function (d, s, id) {
                                var js, fjs = d.getElementsByTagName(s)[0];
                                if (d.getElementById(id)) return;
                                js = d.createElement(s); js.id = id;
                                js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.1';
                                fjs.parentNode.insertBefore(js, fjs);
                            }(document, 'script', 'facebook-jssdk'));</script>
                        <div class="fb-comments" data-href="https://www.facebook.com/Music-Store-2251737218187163/" data-width="500" data-numposts="5"></div>
                    </section>
                </div>
</tbody>
</table>
<br />


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>

    $.ajax({
        type: "POST",
        url: "/Items/getBestAlbum",
        success: function (res) {
            console.log(res);
            var parsed = JSON.parse(res);
            console.log(parsed);

            var max = 0;
            var sum = 0;
            var index = 0;
            for (var i = 0; i < parsed.length; i++) {
                for (var j = 0; j < parsed[i].Sales.length; j++) {

                    sum = sum + parsed[i].Sales[j];
                }
                if (sum > max) {
                    max = sum;
                    index = i;
                }
                sum = 0;
            }


            $("#bestAlbum").append(`<tr><td style="font-size:25px;">${parsed[index].Names}</td></tr>`);




        }
    });
</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        console.log("here");
        $("#SearchBtn").click(function () {
            var CitySr = $("#CitySr").val();
            var Age = $("#Age").val();
            if (Age == "") {
                Age = 0;
            }
            var data = {
                CitySr: CitySr,
                Age: Age
            }
            console.log(data);
            $.ajax({
                type: "POST",
                url: "/Items/getRecomendedAlbum",
                data: data,
                success: function (res) {
                    console.log(res.length);
                    console.log(res);
                    var parsed = JSON.parse(res);
                    console.log(parsed);

                    var current = @DateTime.Now.Year;
                    var delta = 0;
                    var min = 5000;
                    var index = 0;
                    $("#SearchRes").empty();
                    console.log(current);
                    console.log(parsed.length);
                    for (var i = 0; i < parsed.length; i++) {
                        delta = (current-parsed[i].Years) - Age;
                        console.log(parsed[i].Names + ":" + delta);
                        if (delta < 0) {
                            delta = delta * (-1);
                        }
                        if (delta < min) {
                            min = delta;
                            index = i;
                        }
                    }

                    $("#SearchRes").append(`<tr><td>${parsed[index].Names}</td></tr>`);
                }
            });
        });
    });

</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>

    $.ajax({
        type: "POST",
        url: "/Items/getCheapestStore",
        success: function (res) {
            console.log(res.length);
            console.log(res);
            var parsed = JSON.parse(res);
            console.log(parsed);
            var sum = 0.0;
            var avg = 0.0;
            var min = 5000.0;
            var index = 0;
            for (var i = 0; i < parsed.length; i++) {
                for (var j = 0; j < parsed[i].Prices.length; j++) {
                    sum = sum + parsed[i].Prices[j].Price;
                    console.log("Price: " + parsed[i].Prices[j].Price);
                }
                avg = sum / parsed[i].Prices.length;
                console.log(avg);

                if (avg < min) {
                    min = avg;
                    index = i;
                }
                sum = 0;
                avg = 0;
            }
            console.log(parsed[index].Citys);
            $("#Cheapest").append(`<tr><td>${parsed[index].Citys.City}</td></tr>`);
        }
    });

</script>